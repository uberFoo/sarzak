build and install sarzak:
  stage: .pre
  script:
    - "curl -X POST --fail -F token=glptt-8de86eccfbb716aa80ca04f19435aa1dadf34ead -F ref=REF_NAME https://git.uberfoo.com/api/v4/projects/49/trigger/pipeline"

test and code cov:
  stage: build
  script:
    - CARGO_INCREMENTAL=0 RUSTFLAGS='-Cinstrument-coverage' LLVM_PROFILE_FILE='cargo-test-%p-%m.profraw' cargo test
    - grcov . --binary-path ./target/debug/deps/ -s . -t html --branch --ignore-not-existing --ignore '../*' --ignore "/*" -o ./coverage/
    - grcov . --binary-path ./target/debug/deps/ -s . -t lcov --branch --ignore-not-existing --ignore '../*' --ignore "/*" -o coverage.lcov
    - ~/.local/bin/lcov_cobertura coverage.lcov
    - lcov --summary coverage.lcov
  artifacts:
    paths:
      - 'coverage'
      - 'coverage.lcov'
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml
  coverage: '/\s*lines\.*:\s*([\d\.]+%)/'
